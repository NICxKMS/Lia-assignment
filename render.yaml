# Render.com Deployment Configuration
# =====================================
# This file defines the infrastructure for deploying the Lia Chatbot Backend
# on Render.com with automatic scaling and health monitoring.
version: "2.5"
projects:
  - name: Nikhil's Projects
    environments:
      - name: Production
        services:
          - type: web
            name: lia-backend
            runtime: python
            repo: https://github.com/NICxKMS/Lia-assignment
            plan: free
            region: singapore
            rootDir: backend
            # Build configuration
            buildCommand: |
              pip install uv
              uv sync --frozen --no-dev
              uv run alembic upgrade head
            # Start command with proper worker configuration
            startCommand: uv run uvicorn app.main:app --host 0.0.0.0 --port $PORT --workers 2 --loop uvloop --http httptools
            healthCheckPath: /health
            domains:
              - liabackend.nicx.app
            autoDeployTrigger: commit
            buildFilter:
              paths:
                - backend/*
                - render.yaml
            # Environment variables
            envVars:
              # Database (Supabase PostgreSQL)
              - key: DATABASE_URL
                sync: false
              # JWT Authentication
              - key: JWT_SECRET_KEY
                generateValue: true
              - key: JWT_ALGORITHM
                value: HS256
              - key: JWT_ACCESS_TOKEN_EXPIRE_DAYS
                value: "7"
              # LLM Providers
              - key: GEMINI_API_KEY
                sync: false
              - key: OPENAI_API_KEY
                sync: false
              - key: DEFAULT_LLM_PROVIDER
                value: gemini
              - key: DEFAULT_LLM_MODEL
                value: gemini-2.5-flash
              # Upstash Redis
              - key: UPSTASH_REDIS_REST_URL
                sync: false
              - key: UPSTASH_REDIS_REST_TOKEN
                sync: false
              # CORS - Frontend URLs
              - key: CORS_ORIGINS
                value: https://lia.nicx.app,http://localhost:5173,http://localhost:3000
              # Rate Limiting
              - key: RATE_LIMIT_ENABLED
                value: "true"
              - key: RATE_LIMIT_REQUESTS_PER_MINUTE
                value: "120"
              - key: RATE_LIMIT_CHAT_REQUESTS_PER_MINUTE
                value: "45"
              # Application
              - key: APP_NAME
                value: Lia Chatbot
              - key: DEBUG
                value: "false"
              - key: LOG_LEVEL
                value: INFO
              # Python settings
              - key: PYTHONUNBUFFERED
                value: "1"
              - key: PYTHONDONTWRITEBYTECODE
                value: "1"
